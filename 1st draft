/*
 * embedded assign 1.c
 *
 * Created: 20/07/2017 9:53:39 AM
 * Author : cwv0417
 */ 
#include <avr/io.h>
#include <LabBoard.h>
#include <stdio.h>
#include <avr/interrupt.h>

#define UP !(PINA & (1<<3))
#define DOWN !(PINA & (1<<5))

#define rx_full (UCSR1A & (1<<7))
#define tx_empty (UCSR1A & (1<<5))

ISR (USART1_RX_vect); // rx complete
//ISR (USART1_TX_vect); // tx complete
//ISR (USART1_UDRE_vect); // data register empty

void setup (void);
volatile unsigned char position; // the variables that are changed in ISR has to be volatile 
char line0[20];
volatile char buffer[256];

int main(void)
{
	setup();
	while (1)
	{
		/*if(UP)							
		{
			position--;
			cp = position;
		}
		else if(DOWN)						
		{
			position++;
			cp = position;
			
		}*/
		
		if (rx_full)  // if data received
		{
			SLCDClearScreen();
			sprintf(line0,"%2i", UDR1);  //display received data
			SLCDSetCursorPosition(0,0);
			SLCDWriteString(line0);
			
		}
	}
}

ISR (USART1_RX_vect)
{
	/*if (cp = 0)
	{
		UDR1 = "time"; 
	}
	else if (cp = 1)
	{
		UDR1 = "heading";
	}
	else
	{
		UDR1 = "distance";
	}*/
	
		buffer [position++] = UDR1;
	
}

void setup (void)
{
	SLCDInit();         				// Initialize the LCD.
	SLCDDisplayOn();    				// Switched On the LCD.
	SLCDClearScreen();
	
	position = 5;
	DDRA = 0x00;
	DDRC = 0xFF;
	DDRE= 0x03;
	PORTE = 0x00;
	//UCSR1A = 0b00100000;
	UCSR1B = 0b10011000;
	UCSR1C = 0b00000110;
	UBRR1 = 25;
	
	sei();
}
